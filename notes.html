<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Notes</title>

  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; }
    .navbar { display:flex; justify-content:space-between; padding:15px 25px; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    nav a { margin-left:20px; text-decoration:none; font-size:16px; color:#333; }

    .container { max-width:900px; margin:60px auto; }
    h1 { text-align:center; margin-bottom:30px; }

    .note-card {
      background:white; padding:20px; border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,0.08);
      margin-bottom:20px;
    }
    .note-card a { color:#4c6ef5; font-weight:bold; }
    .meta { color:#555; margin-top:8px; }
  </style>
</head>

<body>

<header class="navbar">
  <div class="logo">Class‡§®‡•ã‡§ü‡•ç‡§∏ U.P.S.I.F</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="upload.html">Upload Notes</a>
    <a href="#">Categories</a>
  </nav>
</header>

<div class="container">
  <h1>All Uploaded Notes üìö</h1>
  <p id="loading">Loading notes...</p>
  <div id="notes"></div>
</div>

<script>

// ‚≠ê REAL PROJECT URL
const PROJECT_URL = "https://xpdtmigeeicupyrvvsco.supabase.co";

// ‚≠ê PUBLIC BUCKET URL (GET version)
const PUBLIC_BUCKET_URL = `${PROJECT_URL}/storage/v1/object/public/public-files/`;

// ‚≠ê LIST URL (GET ‚Üí Works on GitHub)
const LIST_URL = `${PROJECT_URL}/storage/v1/object/list/public-files`;

async function loadNotes() {
    const res = await fetch(LIST_URL, {
        method: "GET",
        headers: {
            "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhwZHRtaWdlZWljdXB5cnZ2c2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NDQzNjEsImV4cCI6MjA3OTEyMDM2MX0.N6vuRtutjFvbDpGutvFiWqLWKi5f2TeffiyLuSIt5Fk"
        }
    });

    const data = await res.json();

    document.getElementById("loading").style.display = "none";
    const container = document.getElementById("notes");

    data.forEach(file => {
        const name = file.name;
        if (!name.includes("__meta__")) return;

        const [fileName, metaPart] = name.split("__meta__");

        let meta = {};
        try { meta = JSON.parse(decodeURIComponent(metaPart)); } catch {}

        const fileUrl = PUBLIC_BUCKET_URL + name;

        const card = `
          <div class="note-card">
              <a href="${fileUrl}" target="_blank">üìÑ ${meta.subject || "Untitled"}</a>
              <div class="meta">
                  <b>Category:</b> ${meta.category || ""}
                  <br>
                  <b>Description:</b> ${meta.desc || ""}
              </div>
          </div>
        `;
        container.innerHTML += card;
    });
}

loadNotes();

</script>

</body>
</html>



