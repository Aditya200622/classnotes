<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Notes</title>

  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; }
    .navbar { display:flex; justify-content:space-between; padding:15px 25px; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    nav a { margin-left:20px; text-decoration:none; font-size:16px; color:#333; }

    .container { max-width:900px; margin:60px auto; }
    h1 { text-align:center; margin-bottom:30px; }

    .note-card {
      background:white; padding:20px; border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,0.08);
      margin-bottom:20px;
    }
    .note-card a { color:#4c6ef5; font-weight:bold; }
    .meta { color:#555; margin-top:8px; }
  </style>
</head>

<body>

<header class="navbar">
  <div class="logo">Class‡§®‡•ã‡§ü‡•ç‡§∏ U.P.S.I.F</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="upload.html">Upload Notes</a>
    <a href="#">Categories</a>
  </nav>
</header>

<div class="container">
  <h1>All Uploaded Notes üìö</h1>
  <p id="loading">Loading notes...</p>
  <div id="notes"></div>
</div>

<script>
const PROJECT_URL = "https://xpdtmigeeicupyrvvsco.supabase.co";
const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhwZHRtaWdlZWljdXB5cnZ2c2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NDQzNjEsImV4cCI6MjA3OTEyMDM2MX0.N6vuRtutjFvbDpGutvFiWqLWKi5f2TeffiyLuSIt5Fk";

const BUCKET = "public-files";

async function loadNotes() {

    const url = `${PROJECT_URL}/storage/v1/object/list/${BUCKET}`;

    const res = await fetch(url, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "apikey": ANON_KEY,
            "Authorization": `Bearer ${ANON_KEY}`
        },
        body: JSON.stringify({
            prefix: "",       // root folder
        })
    });

    const data = await res.json();

    console.log("LIST RESPONSE =", data); // DEBUG

    document.getElementById("loading").style.display = "none";
    const container = document.getElementById("notes");

    if (!Array.isArray(data)) {
        container.innerHTML = "<p>‚ùå Failed to load notes.</p>";
        return;
    }

    data.forEach(file => {
        const name = file.name;

        if (!name.includes("__meta__")) return;

        const [pure, metaPart] = name.split("__meta__");

        let meta = {};
        try {
            meta = JSON.parse(decodeURIComponent(metaPart));
        } catch {}

        const fileUrl = `${PROJECT_URL}/storage/v1/object/public/${BUCKET}/${name}`;

        const card = `
            <div class="note-card">
                <a href="${fileUrl}" target="_blank">üìÑ ${meta.subject || "Untitled"}</a>
                <div class="meta">
                    <b>Category:</b> ${meta.category || ""}
                    <br>
                    <b>Description:</b> ${meta.desc || ""}
                </div>
            </div>
        `;

        container.innerHTML += card;
    });

}
loadNotes();
</script>

</body>
</html>



